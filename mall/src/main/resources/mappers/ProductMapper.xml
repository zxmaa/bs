<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd">
<mapper namespace="com.bs.mall.dao.ProductMapper">
    <select id="queryProductList" resultType="com.bs.mall.dao.pojo.Product">
        select *
        from product
        <where>
            <if test="null != categoryId">
               and  product_category_id = #{categoryId}
            </if>
            <if test="null != searchValue and searchValue != ''">
                and
                <foreach collection="searchValueSplit" index="index" item="item" open="(" separator="or" close=")">
                    product_name LIKE concat('%',#{item},'%')
                </foreach>
            </if>

        </where>
        <if test="null != orderBy and orderBy!= ''">
            order by ${orderBy}
            <if test="null != isDesc and isDesc = true"> <!--注：不写默认为升序-->
                desc
            </if>
        </if>
    </select>

    <select id="selectTotal" resultType="int">
        SELECT COUNT(product_id) FROM product
        <where>
            <if test="product != null">
                <if test="product.product_name != null">product_name LIKE concat('%',#{product.product_name},'%')</if>
                <if test="product.product_price != null">and product_sale_price &lt;= #{product.product_price}</if>
                <if test="product.product_sale_price != null">and product_sale_price &gt;= #{product.product_sale_price}</if>
                <if test="product.product_category != null">
                    <if test="product.product_category.category_id != null">and product_category_id =
                        #{product.product_category.category_id}
                    </if>
                </if>
            </if>
            <if test="product_isEnabled_array != null">and product_isEnabled IN
                <foreach collection="product_isEnabled_array" index="index" item="item" open="(" separator=","
                         close=")">
                    #{item}
                </foreach>
            </if>
        </where>
    </select>

    <!--  ==================================fore=========================================-->
    <select id="queryProductListFore" resultType="com.bs.mall.dao.pojo.Product">
        select *
        from product
        <where>
            <if test="null != categoryId">
                and  product_category_id = #{categoryId}
            </if>
            <if test="null != searchValue and searchValue != ''">
                and
                <foreach collection="searchValueSplit" index="index" item="item" open="(" separator="or" close=")">
                    product_name LIKE concat('%',#{item},'%')
                </foreach>
            </if>

        </where>
        <if test="null != orderBy and orderBy!= ''">
            order by ${orderBy}
            <if test="null != isDesc and isDesc = true"> <!--注：不写默认为升序-->
                desc
            </if>
        </if>
    </select>

    <select id="getPropertyValueByProductIdFore" resultType="com.bs.mall.dto.res.ForePropertyValueResDto">
        select t1.property_name,t2.property_value_value
        from  property_value t2
        left join  property t1  on t1.property_id = t2.property_id
        where t2.product_id = #{productId}
    </select>

    <select id="getReviewFore" resultType="com.bs.mall.dto.res.ForeReviewSimpleResDto">
        select t2.user_name,t1.review_content,t1.review_createdate
        from review t1
        left join user t2 on t1.user_id = t2.user_id
        where t1.product_id = #{productId}
    </select>
</mapper>